<!DOCTYPE html>
<html>

<head>
    <title>Bus Raider</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="WebUI for Bus Raider">
    <meta name="author" content="Rob Dobson">
    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAMAEBAAAAEAIABoBAAANgAAACAgAAABACAAKBEAAJ4EAAAwMAAAAQAgAGgmAADGFQAAKAAAABAAAAAgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAO2cHn7unCD47pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg+O+dH33unCD57pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD57pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//fWpP/42av/+Nmr//CpPv/0w3n/+N21//fWpP/vpDL/7p8n//bQl//53rX/9MN4/+6cIP/unCD/7pwg/+6cIP/758v/8bJR/+6cIP/uoCr//ffu/+6eJv/20JX/9ciF//O6ZP/43LH/7p0j//zz5v/uoS3/7pwg/+6cIP/unCD/9MN4//jXpv/unCD/76It//326//unCD/9sqI//bKiP/zvGj/+Nem/+6cIP/88N7/76Mx/+6cIP/unCD/7pwg/++iLf/99en/7qAp/+6cIf/66M3/99Wh//vu2v/xs1X/87xo//jXpv/unCD//PDe/++jMf/unCD/7pwg/+6cIP/unCD/+Nyx//PAcf/unCD//PDe//O/b//65sf/87xo//O8aP/416b/7pwg//zw3v/vozH/7pwg/+6cIP/unCD/7pwg//K3Xv/65cb/7pwg//337v/unyj/99Oc//XFfP/zvGj/+Nem/+6cIP/88N7/76Mx/+6cIP/unCD/7pwg//CtRv/ytVr//fny/++oO//879v/8rlj//nhvf/zumX/8rde//vs1P/0wXT//fju/+6gK//unCD/7pwg/+6cIP/ytVr/9MFz//TBc//vpDL/8Kk///XHgf/zu2f/7pwg/+6cIf/zumX/9ciD//GwT//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/75wg+O6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7psf+O2cHn7unCD47pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7psg+O+bH30AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAACAAAABAAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//AAHvmx997p0f5O6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7p0f5O+cH3z//wAB7psfe+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6dH3rvnCDo7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7Zwf5+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/8bJS//K0V//ytFf/8rRX//K0V//ytFf/76Y4/+6cIP/unCD/8Kg9//O/cP/1xHv/871q/++lNP/unCD/7pwg/+6cIP/unCD/7p4l//K2XP/1xHv/9MBy//CoO//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/99en////////////////////////////1x4D/7pwg//bMjf/+/v3//v38//337v/+/v3//vv4//O9av/unCD/7pwg//CoPP/88N////7+//347//+/Pn//v38//bMjP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//rkwv///v7/8rVZ/+6cIP/unCD/7pwg/+6cIP/uoi7//vv3//337v/vpjj/7pwg//GvTP/+/fr//PPk/+6cIP/unCD/99Sf///////0xHv/7pwg/++hLf/88eH//vz6/++kNP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/9L5v///////4267/7pwg/+6cIP/unCD/7pwg//CoPP///v3//O7Y/+6cIP/unCD/7pwg//748P/++PD/7pwg/+6cIP/53LH///////GwTv/unCD/7pwg//rivv//////8KtC/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/uoCv//fjw//769P/voi7/7pwg/+6cIP/unCD/8Kg8///+/f/87tj/7pwg/+6cIP/unCD//vjw//748P/unCD/7pwg//ncsf//////8bBO/+6cIP/unCD/+uK+///////wq0L/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/42Kf///////TDeP/unCD/7pwg/+6cIP/wqDv///79//zu2v/unCD/7pwg/+6cIP/++fH//vjw/+6cIP/unCD/+dyx///////xsE7/7pwg/+6cIP/64r7///////CrQv/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//K0Vf///v7/++jN/+6cIP/unCD/7pwg/+6fJv/99Of//vz6//O6Y//unib/9MJ3//7+/v/76tD/7pwg/+6cIP/53LH///////GwTv/unCD/7pwg//rivv//////8KtC/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwi//zw3v/+/vz/8KxG/+6cIP/unCD/7pwg//K1Wv/+/fr//////////////////vr1//CsRP/unCD/7pwg//ncsf//////8bBO/+6cIP/unCD/+uK+///////wq0L/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/9syO///////20Zj/7pwg/+6cIP/unCD/99Oe///////76c7/9tCV//zu2f//////9s2P/+6cIP/unCD/+dyx///////xsE7/7pwg/+6cIP/64r7///////CrQv/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/wqT3//v37//316P/uniX/7pwg/+6cIP/88N////79//CnOv/unCD/8K1G///+/v/769P/7pwg/+6cIP/53LH///////GwTv/unCD/7pwg//rivv//////8KtC/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/65cb////+//O5Y//unCD/7pwg//3y4v/+/fv/76Qz/+6cIP/wqDz///79//zu2P/unCD/7pwg//ncsf//////8bBO/+6cIP/unCD/+uK+///////wq0L/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//TAcv//////+d+4/+6cIP/unCD//fLi//78+f/voi7/7pwg//CoPP///v3//O7Y/+6cIP/unCD/+dyx///////xsE7/7pwg/+6cIP/64r7///////CrQv/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7qEs//758v/++/j/76U1/+6cIP/879z//v37/++lNv/unCD/8Kk////+/v/76c3/7pwg/+6cIP/53LH///////O6Y//unCD/7pwg//vr0v//////8KtC/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/xr0z/9s2P//bNj//2zY///PHf///////0w3j/7pwg//fRmf//////+d+4//XFfv/54Lr///////XKiP/unCD/7pwg//XKiP///////fjw//rivv/769L////+//337P/uoCr/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//K5Y//65sf/+ubH//rmx//65sf/+ubH//O8aP/unCD/7p8n//bQlv/879r//fbq//vs1v/1yYf/7p0j/+6cIP/unCD/7p0k//XJhv/76tH//fbr//3z5P/53bP/8a5J/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cH/7umx/m7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwf5e6dH3runCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/smx96//8AAe2cHn7unR/k7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/umx/k75wffP//AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADumREP75seXu6cHsLunB/07pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unR/27Zsfxe2cH2LxnBwSAAAAAOaZGgrvnR+M7Zwf9+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++cIPnvmx+c7pkRD+6bHVnumyD47pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/vnCD57ZofYu+bIMnunCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/75seyu6bH/bunCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7Zsf9u6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++jMf/vpTT/76U0/++lNP/vpTT/76U0/++lNP/vpTT/76U0/++jL//unCD/7pwg/+6cIP/unCH/76Iv/++oO//wqkH/8KtC//CpP//vpDP/7p0j/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/uoCn/76c5//CrQv/wq0L/8Kg8/++iL//unCH/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//fYqv/65sf/+ubH//rmx//65sf/+ubH//rmx//65sf/+ubH//fUnv/unCD/7pwg/+6fJv/zwHL/+d+3//vt2P/99en//fbq//zy4//65MP/9syN/++mN//unCD/7pwg/+6cIP/unCD/7pwg//K3Xf/416b/++vU//316v/99er//O/c//nfuP/0wnb/7qAp/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//vt2P////////////////////////////////////////////vnyP/unCD/7pwg//bKiv/++vb//v7+//7+/f/99ev//PLj//79+v///////v38//rmyP/uozL/7pwg/+6cIP/unCD/875v//748f/+/v7///7+//316P/88uP//vz7//7+/v/++/f/9s+U/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//jarf///v7///79//O9a//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7qIu//327f///////fjx//K5Y//unCD/7pwg/++mOf/65MP//v7+//779v/0w3j/7pwg/+6cIP/uoSz/++nP///////99+7/8rhh/+6cIP/unCD/8KtC//zx4f///////fny/++mNv/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//G1WP/++vX///////rkw//unyj/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/8K5J///9+///////+ubG/+6cIP/unCD/7pwg/+6cIf/1xHz//v36//79+//2zIz/7pwg/+6cIP/vqDz//PHg///////76Mv/76Qz/+6cIP/unCD/7pwg//fRmf////////7+//G0WP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++jMP/65sj///////337f/ys1T/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/8bBN///+/P//////+uPA/+6cIP/unCD/7pwg/+6cIP/0wXT//vz5//79+//2zIz/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6dJP/2zY7//v38//79+//2zpD/7pwi/+6cIP/unCD/7pwg/+6cIP/unCD/8bBN///+/P//////+uPA/+6cIP/unCD/7pwg/+6cIP/0wXT//vz5//79+//2zIz/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/ytVn//fft//7+/v/65cb/76Mx/+6cIP/unCD/7pwg/+6cIP/unCD/8bBN///+/P//////+uPA/+6cIP/unCD/7pwg/+6cIP/0wXT//vz5//79+//2zIz/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/uoi3/++rQ///////9+fL/8bFP/+6cIP/unCD/7pwg/+6cIP/unCD/8a9M///9/P//////+uXE/+6cIP/unCD/7pwg/+6cIP/0wnb//vz6//79+//2zIz/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/9syM///+/v///v7/99CY/+6cIP/unCD/7pwg/+6cIP/unCD/76Mx//306f///////fnx//GwTv/unyf/7p0i/++nOf/43LL//v7+//779v/0w3n/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/8Kk9//748f///////PPl/++jMf/unCD/7pwg/+6cIP/unCD/7pwg//TGf//9+PH///////zy4v/31qT/9tCW//rjwf/+/Pn///7+//rivv/vpjf/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//jarP///////v7+//TEev/unCD/7pwg/+6cIP/unCD/7pwg/+6fKf/20pr//v38/////////////////////////////PLj/++mOP/unCD/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//K1Wv/++/f///////rozv/uoCr/7pwg/+6cIP/unCD/7pwg//CwTv/99er///////769f/879z/++3X//306P/+/v3///////jdtP/unyf/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++jMf/76c7////+//347v/ytlv/7pwg/+6cIP/unCD/7pwg//jXpv///v7///7+//bOkv/vpTT/7p8n//K1Wv/77df///////337v/xs1b/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6dJP/2zI7//v78//79/P/30Zn/7p0j/+6cIP/unCD/7pwg//vnyv////////z6//CsRf/unCD/7pwg/+6fJ//31qL///7+//769f/0v3D/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/ytlz//ffu/////v/76Mz/76Q0/+6cIP/unCD/7pwg//vozP///////vz5//CrQv/unCD/7pwg/+6fJ//31J////7+//769f/0wHL/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/vozH/++rQ///////9+fP/8bRY/+6cIP/unCD/7pwg//vozP///////vv3/++oPP/unCD/7pwg/+6fJ//31J////7+//769f/0wHL/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/9cyL///////+/v7/99el/+6cIP/unCD/7pwg//vozP///////vr1/++mOP/unCD/7pwg/+6fJ//31J////7+//769f/0wHL/7pwg/+6cIP/wqT3//PLh///////65cb/76Mx/+6cIP/unCD/7pwg//bMjf////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/76pA//358////////fbt/+6kNP/unCD/7pwg//vmyP///////vv3//CqQP/unCD/7pwg/+6fJ//31aH///7+//768//zvWv/7pwg/+6cIP/wqT3//PLh///////76c//76U1/+6cIP/unCD/7pwg//fUn/////////////K2W//unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg//netf////////7+//XIhf/unCD/7pwg//fSm////v7///79//XGf//unSP/7pwg/++lNf/65MP///7+//326//xsE7/7pwg/+6cIP/vpjj//O/c///////++fL/9cqJ//GwT//xsE7/879v//305v///////v38//GxUP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++kM//66M3//PLj//zy4//88uP//PLj//348f////////////rlxf/unCD/7pwg//CsRv/99ej///////768//769L/+uTD//zx4P/+/fr///////jYqP/unSP/7pwg/+6cIP/unSL/+Nin//////////7//vz5//337//99+7//vv2/////v//////++rP/+6eJP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++kNP/769P//fXq//316v/99er//fXq//316v/99er//fXq//nguP/unCD/7pwg/+6dIv/zvWz/++7Y//337f/++/b//vv3//358//88+T/99Wh/+6fKP/unCD/7pwg/+6cIP/unCD/7qAr//fUn//88eH//fjw//779//++/f//vnz//305v/54b3/8KpB/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6eJf/xsVH/8rRX//K0V//ytFf/8rRX//K0V//ytFf/8rRX//GuSv/unCD/7pwg/+6cIP/unCD/8Kk9//K5Yv/0w3n/9cR7//O/cP/wr0v/7p4k/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6dIv/wq0P/87xq//XEe//1xHv/9L9w//GxT//uoSv/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwf/u6cH/TunCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7Zse8+6cHsPunCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7psfxeybH1Ltmx/17pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/tnCD37JseXOaZGgrtnB+N7Zwf9+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/++cIPntmx+c7pkRDwAAAADmmRoK7Z0fU+2dH73unB/z7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/unCD/7pwg/+6cIP/tmx/27psfwO2bHVfqlRUMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />
    <!-- <script src="TerminalEmulator.js"></script> -->
    <script type="text/javascript">
        function bodyIsLoaded() {
            window.pageState = {
                uploadProgress: [],
                latestFileInfo: null,
                machineConfigs: [],
                machineConfigCurIdx: 0,
                machineList: [],
                machinePopupIdx: 0,
                terminalLineData: [],
                terminalRows: 25,
                terminalCols: 80,
                fsDefault: "spiffs",
                termColours: []
            }

            // Set terminal colours
            this.setAnsiColours();

            // Select
            this.setupSelectMachine(this.mcDropDownActive, this.mcDropDownClose);

            // Insert tabs when tab pressed in machine popup
            enableTabInsertion('popup-machine-text');

            // Drag and drop
            let dropZones = document.getElementsByClassName("drop-zone");
            Array.from(dropZones).forEach(function (dropZone) {

                // Prevent default drag behaviors
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false)
                    document.body.addEventListener(eventName, preventDefaults, false)
                });

                // Highlight drop area when item is dragged over it
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, highlight, false)
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, unhighlight, false)
                });

                // Handle dropped files
                dropZone.addEventListener('drop', handleDrop, false);
            });

            // Populate machine list
            callAjax("/querystatus", populateMcList);

            // Request file list to display
            fileListUpdate();

            // // Create terminal emulator
            // window.pageState.term = new TerminalEmulator("term", true, true, 80, 25, false, 25);
            // window.pageState.term.setInputCallback(terminalEmulatorCharCallback);
            // let termArea = document.getElementById("terminal-area");
            // termArea.appendChild(window.pageState.term.html);

            // Open a web socket for screen mirroring
            window.pageState.screenMirrorWebSocket = new WebSocket("ws://" + location.host + "/ws", "screen");
            window.pageState.screenMirrorWebSocket.binaryType = 'arraybuffer';
            window.pageState.screenMirrorWebSocket.onopen = function () 
            {
                console.log("Web socket open");
            }
            window.pageState.screenMirrorWebSocket.onclose = function () 
            {
                console.log("Web socket closed");
            }
            window.pageState.screenMirrorWebSocket.onmessage = function(event)
            {
                const SIZE_OF_MSG_CHAR_DATA = 6;
                const SIZE_OF_BUF_CHAR_DATA = 4;
                // console.log(event.data.byteLength);
                const binData = new Uint8Array(event.data);
                // Find C string terminator of JSON section
                function isTerm(element, index, array) {
                    return element === 0;
                }
                const strTermPos = binData.findIndex(isTerm);
                if (strTermPos + 3 < binData.byteLength)
                {
                    // Get terminal window
                    let termText = document.getElementById("term-text");
                    let anyChange = false;
                    // Extract screen size
                    let chPos = strTermPos+1;
                    window.pageState.terminalCols = binData[chPos++];
                    window.pageState.terminalRows = binData[chPos++];
                    console.log("Screen dimensions cols", window.pageState.terminalCols, "rows", window.pageState.terminalRows);
                    if ((window.pageState.terminalLineData.length < window.pageState.terminalRows) || 
                            (window.pageState.terminalLineData[0].byteLength/SIZE_OF_BUF_CHAR_DATA < window.pageState.terminalCols))
                    {
                        // Start buffer (again) on screen dimensions init or change
                        window.pageState.terminalLineData = [];
                        termText.innerHTML = "";
                        for (let i = 0; i < window.pageState.terminalRows; i++)
                        {
                            let newLine = new Uint8Array(window.pageState.terminalCols*SIZE_OF_BUF_CHAR_DATA);
                            for (let j = 0; j < window.pageState.terminalCols; j+=4)
                            {
                                newLine[j] = 0x20; 
                                newLine[j+1] = 15;
                                newLine[j+2] = 0;
                                newLine[j+3] = 0;
                            }
                            window.pageState.terminalLineData.push(newLine);
                            let newPara = document.createElement("pre");
                            termText.appendChild(newPara);
                        }
                        anyChange = true;
                    }

                    // Extract character blocks
                    if (chPos + SIZE_OF_MSG_CHAR_DATA < binData.byteLength)
                    {
                        for (let i = 0; i < (binData.byteLength - strTermPos - 1) / SIZE_OF_MSG_CHAR_DATA; i++)
                        {
                            let col = binData[chPos];
                            let row = binData[chPos+1];
                            // Update lines
                            if ((row < window.pageState.terminalRows) && (col < window.pageState.terminalCols))
                            {
                                bufPos = col*SIZE_OF_BUF_CHAR_DATA;
                                chPos += 2;
                                for (let k = 0; k < SIZE_OF_BUF_CHAR_DATA; k++)
                                    window.pageState.terminalLineData[row][bufPos++] = binData[chPos++];
                                anyChange = true;
                            }
                            else
                            {
                                break;
                            }
                        }
                    }

                    // Write chars
                    if (anyChange)
                    {
                        let termLines = termText.childNodes;
                        for (let i = 0; i < Math.min(window.pageState.terminalRows, termLines.length); i++)
                        {
                            let lineStr = "";
                            let lineData = window.pageState.terminalLineData[i]
                            for (let j = 0; j < window.pageState.terminalCols; j++)
                            {
                                const fore = lineData[j*SIZE_OF_BUF_CHAR_DATA+1];
                                const back = lineData[j*SIZE_OF_BUF_CHAR_DATA+2];
                                if ((fore != 15) || (back != 0))
                                    lineStr += "<span style=\"color:#" + window.pageState.termColours[fore] + ";background-color:#" + window.pageState.termColours[back] + ";\">";
                                lineStr += String.fromCharCode(lineData[j*SIZE_OF_BUF_CHAR_DATA]);
                                if ((fore != 15) || (back != 0))
                                    lineStr += "</span>";
                            }
                            termLines[i].innerHTML = lineStr;
                        }
                    }
                }

                // let eventInfo = JSON.parse(event.data);
                // if (eventInfo && eventInfo.dataType === "key")
                //     window.pageState.term.showString(eventInfo.val);
            }
        }

        // function terminalEmulatorCharCallback(ch)
        // {
        //     if (window.pageState.terminalKeysSocket)
        //     {
        //         let msg = { dataType: "key", val: ch };
        //         let jsonRaw = JSON.stringify(msg);
        //         window.pageState.terminalKeysSocket.send(jsonRaw);
        //         window.pageState.terminalKeysSocket.send("{\"dataType\":\"key\",\"val\":\"" + ch + "\"}");
        //     }
        //     // alert(ch + "==>" + ch.charCodeAt(0));
        // }

        function populateMcList(jsonResp) {
            let status = JSON.parse(jsonResp);
            window.pageState.machineList = status.machineList;
            if (window.pageState.machineList === undefined)
                window.pageState.machineList = [];
            // Clear list and fill
            let mcListSelect = document.getElementById("machine-select");
            if (mcListSelect && window.pageState.machineList) {
                for (let i = 0; i < mcListSelect.options.length; i++)
                    mcListSelect.remove(i);
                for (let i = 0; i < window.pageState.machineList.length; i++) {
                    let option = document.createElement('option');
                    option.text = window.pageState.machineList[i];
                    option.value = window.pageState.machineList[i];
                    mcListSelect.add(option);
                }
                // Set current machine
                mcListSelect.value = status.machineCur;
            }
            // Re-setup select
            this.setupSelectMachine(this.mcDropDownActive, this.mcDropDownClose);
            // Setup machine config files for each machine
            window.pageState.machineConfigs = [];
            for (let i = 0; i < window.pageState.machineList.length; i++) {
                // setup config file
                let configContent = {}; 
                window.pageState.machineConfigs.push(configContent);
            }
            // Show frequency
            showFrequency(status);
            // Start getting first machine's config
            machineConfigReq(true);
        }

        function queryStatusUpdate()
        {
            callAjax("/querystatus", updateMachineInfo);
        }

        function updateMachineInfo(jsonResp)
        {
            let status = JSON.parse(jsonResp);
            // Show frequency
            showFrequency(status);
        }

        function showFrequency(status)
        {
            try
            {
                let clockHz = status.clockHz;
                if ((clockHz > 0) && (clockHz < 1000000000))
                {
                    let clockDisp = document.getElementById('clock-freq-hz');
                    clockDisp.value = clockHz / 1000000;
                }
            }
            catch(e)
            {
            }
        }

        function machineConfigReq(first)
        {
            let fileIdx = 0
            if (!first)
                fileIdx = window.pageState.machineConfigCurIdx + 1;
            if (fileIdx >= window.pageState.machineList.length)
                return;
            let fileName = window.pageState.machineList[fileIdx]
            window.pageState.machineConfigCurIdx = fileIdx;
            callAjax("/files/" + window.pageState.fsDefault + "/" + fileName + ".json", machineConfigGot, machineConfigGetFailed);
        }

        function machineConfigGot(jsonResp) {
            console.log(jsonResp);
            let fileIdx = window.pageState.machineConfigCurIdx;
            let fileName = window.pageState.machineList[fileIdx]
            try
            {
                window.pageState.machineConfigs[fileIdx] = JSON.parse(jsonResp);
            }
            catch (e)
            {
                console.log("Failed to parse received JSON", jsonResp, e);
            }
            // Get next config if there is one
            machineConfigReq(false);
        }

        function machineConfigGetFailed(jsonResp) {
            console.log("File not found");
            let fileIdx = window.pageState.machineConfigCurIdx;
            let fileName = window.pageState.machineList[fileIdx]
            let fileContent = { name: fileName, hw: [] };
            window.pageState.machineConfigs[fileIdx] = fileContent;
            // Get next config if there is one
            machineConfigReq(false);
        }

        function machineConfigCancel() {
            event.preventDefault();
            machinePopupClose(false);
        }

        function machineConfigOk() {
            event.preventDefault();
            let mcName = window.pageState.machineList[window.pageState.machinePopupIdx];
            // Get Json from form
            let formJson = document.getElementById('popup-machine-text').value;
            // Check for no changes
            if (formJson == JSON.stringify(window.pageState.machineConfigs[window.pageState.machinePopupIdx], null, 2))
            {
                machinePopupClose(false);
                return false;
            }
            if (!machineConfigValidateForm())
                return false;
            // Format Json and ensure machine name is right
            let unJson = JSON.parse(formJson);
            unJson["name"] = mcName;
            window.pageState.machineConfigBeingWritten = unJson;
            formJson = JSON.stringify(unJson, null, 2);
            // Upload file
            let formData = new FormData();
            let contentBlob = new Blob([formJson], {type: 'plain/text'});
            formData.append("file", contentBlob, mcName + ".json");
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function()
            {
                if (xmlhttp.readyState === 4) {
                    if (xmlhttp.status === 200) {
                        console.log("Save response " + xmlhttp.responseText);
                        machinePopupClose(false);
                        // Update 
                        window.pageState.machineConfigs[window.pageState.machinePopupIdx] = window.pageState.machineConfigBeingWritten;
                        // Set machine
                        sendSelectMachine();
                    }
                    else {
                        console.log("Save failed " + xmlhttp.responseText);
                        alert("Save config failed");
                    }
                }
            };
            xmlhttp.open('POST', "/fileupload");
            xmlhttp.send(formData);
            return true;
        }

        function machinePopupToggle() {
            event.preventDefault();
            let pop = document.getElementById('popup-machine');
            if (pop.classList.contains('popup-hidden'))
                machinePopupShow();
            else
                machinePopupClose(true);
        }

        function machinePopupShow() {
            let pop = document.getElementById('popup-machine');
            if (!pop.classList.contains('popup-hidden'))
                return;
            pop.classList.remove('popup-hidden');
            let selIdx = document.getElementById("machine-select").selectedIndex;
            window.pageState.machinePopupIdx = selIdx;
            let popText = document.getElementById('popup-machine-text');
            popText.value = JSON.stringify(window.pageState.machineConfigs[selIdx], null, 2)
            machineConfigValidateForm();
        }

        function machinePopupClose(doSave) {
            let pop = document.getElementById('popup-machine');
            if (pop.classList.contains('popup-hidden'))
                return false;
            
            pop.classList.add('popup-hidden');
            if (doSave)
            {
                return machineConfigOk();
            }
            return false;
        }

        function machineConfigValidateForm()
        {
            let valid = false;
            let errorText = ""
            let formJson = document.getElementById('popup-machine-text').value;
            try
            {
                let unJson = JSON.parse(formJson);
                valid = true;
            }
            catch (e)
            {
                errorText = e.text;
            }
            let confStatus = document.getElementById('popup-machine-status');
            if (valid)
            {
                confStatus.innerHTML = "Valid";
                confStatus.classList.add('data-valid')
                confStatus.classList.remove('data-invalid')
            }
            else
            {
                confStatus.innerHTML = "Invalid JSON " + errorText;
                confStatus.classList.add('data-invalid')
                confStatus.classList.remove('data-valid')
            }
            return valid;
        }

        function clockHzSet() {
            try
            {
                let clockDisp = document.getElementById('clock-freq-hz');
                let clockHz = Math.floor(clockDisp.value * 1000000);
                if ((clockHz > 0) && (clockHz < 1000000000))
                {
                    let clockHzJson = {clockHz:clockHz};
                    postAjax('/targetcmd/clockhzset', clockHzJson)
                }
            }
            catch (e)
            {

            }        
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            let regionId = e.currentTarget.id;
            let dropArea = document.getElementById(regionId);
            dropArea.classList.add('highlight');
        }

        function unhighlight(e) {
            let regionId = e.currentTarget.id;
            let dropArea = document.getElementById(regionId);
            dropArea.classList.remove('highlight');
        }

        function handleDrop(e) {
            var dt = e.dataTransfer;
            var files = dt.files;
            let regionId = e.currentTarget.id;
            if (regionId === "file-manager")
                uploadToFileManager(files);
            else
                uploadAndRunFiles(files);
        }

        function initializeProgress(numFiles, progressBarName) {
            window.pageState.uploadProgress = []
            let progressBar = document.getElementById(progressBarName);
            progressBar.value = 0;
            for (let i = numFiles; i > 0; i--) {
                window.pageState.uploadProgress.push(0);
            }
        }

        function updateProgress(fileNumber, percent, progressBarName) {
            let progressBar = document.getElementById(progressBarName);
            window.pageState.uploadProgress[fileNumber] = percent;
            let total = window.pageState.uploadProgress.reduce((tot, curr) => tot + curr, 0) / 
                        window.pageState.uploadProgress.length;
            // console.debug('update', fileNumber, percent, total);
            progressBar.value = total;
        }

        function uploadToFileManager(files) {
            filesArray = [...files];
            initializeProgress(filesArray.length, 'progress-bar-file-manager');
            filesArray.forEach(uploadOnlyFile);
            document.getElementById("fileElemUpload").value = ""
        }

        function uploadOnlyFile(file, i) {
            uploadFileSpecUrl("/fileupload", 'progress-bar-file-manager', file, i)
        }

        function uploadAndRunFiles(files) {
            filesArray = [...files];
            initializeProgress(filesArray.length, 'progress-bar-run');
            filesArray.forEach(uploadAndRunFile);
            document.getElementById("fileElemRun").value = ""
        }

        function uploadAndRunFile(file, i) {
            sendCmdToTarget("progClear");
            uploadFileSpecUrl("/uploadandrun", 'progress-bar-run', file, i);
        }

        function uploadFileSpecUrl(url, progressBarName, file, i) {
            var xhr = new XMLHttpRequest();
            var formData = new FormData();
            xhr.open('POST', url, true);
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');

            // Update progress (can be used to show progress indicator)
            xhr.upload.addEventListener("progress", function (e) {
                updateProgress(i, (e.loaded * 100.0 / e.total) || 100, progressBarName);
                // console.log("Progress" + e.loaded + ", " + e.total);
            });

            xhr.addEventListener('readystatechange', function (e) {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    updateProgress(i, 100, progressBarName)
                    fileListUpdate();
                } else if (xhr.readyState === 4 && xhr.status != 200) {
                    // Error
                }
            });

            formData.append('file', file);
            xhr.send(formData);
        }

        function sendCmdToTarget(targetCmd) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', "/targetcmd/" + targetCmd);
            xhr.send();
        }

        function termShowClick(event) {
            // console.log(event);
            event.srcElement.classList.toggle("radio-on");
            let termPanel = document.getElementById("term-panel");
            if (event.srcElement.classList.contains("radio-on"))
            {
                termPanel.classList.remove("panel-hidden");
                callAjax("/targetcmd/mirrorscreenon");
                document.onkeydown = "termKeyDown(event)";
                event.srcElement.innerHTML = "Hide Terminal";
                termPanel.focus();
            }
            else
            {
                termPanel.classList.add("panel-hidden");
                callAjax("/targetcmd/mirrorscreenoff");
                document.onkeydown = null;
                event.srcElement.innerHTML = "Show Terminal";
            }
        }

        function debuggerShowClick(event) {
            event.srcElement.classList.toggle("radio-on");
            let debuggerPanel = document.getElementById("debugger-panel");
            if (event.srcElement.classList.contains("radio-on"))
            {
                debuggerPanel.classList.remove("panel-hidden");
                event.srcElement.innerHTML = "Hide Debugger";
            }
            else
            {
                debuggerPanel.classList.add("panel-hidden");
                event.srcElement.innerHTML = "Show Debugger";
            }
        }

        function debuggerFlagStr(flags) {
            const flagStr = "SZ H PNC"
            let fMask = 0x80;
            let rsltStr = ""
            for (let i = 0; i < 8; i++) {
                rsltStr += ((fMask & flags) != 0) ? flagStr[i] : " ";
                fMask = fMask >> 1;
            }
            return rsltStr;
        }
        function enableDebugger(en) {
            const elList = [document.getElementById('debugger-disregs'),
                    document.getElementById('debugger-mem1'),
                    document.getElementById('debugger-mem2')];
            elList.forEach((el) => {
                if (en) {
                    el.classList.add("uiDisable");
                } else {
                    el.classList.remove("uiDisable");
                }
            });
        }
        function intToHex(val, digits, uc=true) {
            let st = "0000" + val.toString(16);
            if (uc)
                st = st.toUpperCase();
            return st.slice(st.length-digits);
        }
        function hexDisplayUpdate(jsonRslt, elementId) {
            console.log(jsonRslt, elementId);
            const rslt = JSON.parse(jsonRslt);
            const memData = rslt.data;
            const memAddr = rslt.addr;
            const el = document.getElementById(elementId);
            let dumpHtml = "";
            let addr = parseInt(memAddr, 16);
            for (let i = 0; i < memData.length; i+=2) {
                if (i % 32 === 0) {
                    if (i !== 0)
                        dumpHtml += "\n";
                    dumpHtml += intToHex(addr, 4) + " ";                    
                    addr += 16;
                }
                dumpHtml += intToHex(memData.slice(i,i+2), 2) + " ";
            }
            el.innerHTML = dumpHtml;
        }
        function showHexDump(addr, memDumpElementId) {
            callAjaxWithParam('/targetcmd/Rd/' + intToHex(addr, 4) + '/100', hexDisplayUpdate, memDumpElementId);
        }
        function debuggerUpdate(rslt) {
            enableDebugger(true)
            console.log(rslt);
            // Regs
            const regsObj = JSON.parse(rslt);
            const regNames = ["PC","SP","BC","AF","HL","DE","IX","IY","AFDASH","BCDASH","HLDASH","DEDASH","I","R","IM","IFF"];
            regNames.forEach((reg) => {
                const el = document.getElementById("regs-" + reg);
                const regStr = regsObj[reg]
                el.innerHTML = typeof regStr === 'string' ? regStr.replace("0x","").toUpperCase() : regStr;
            });
            const f1 = document.getElementById("regs-FLAGS");
            f1.innerHTML = debuggerFlagStr(parseInt(regsObj["AF"],16) & 0xf0);
            const f1Dash = document.getElementById("regs-FLAGSDASH");
            f1Dash.innerHTML = debuggerFlagStr(parseInt(regsObj["AFDASH"],16) & 0xf0);
            // Disassembly
            const el = document.getElementById("debugger-disasm");
            const disasmLines = regsObj.disasm.split('%');
            let disasmText = "";
            for (let i = 0; i < disasmLines.length; i++) {
                lin = disasmLines[i];
                lin = lin.replace(/\~/g, '\t')
                lin = lin.replace(/\^/g, '\t')
                lin = lin.toUpperCase()
                disasmText += lin + '<BR>';
            }
            el.innerHTML = disasmText;
            showHexDumps();
        }

        function mcDropDownClose() {
            if (!machinePopupClose(true))
                sendSelectMachine();
        }

        function mcDropDownActive() {
            // Close popup and set machine if it was active and changed
            machinePopupClose(true);
        }

        function sendSelectMachine() {
            let mcIdx = document.getElementById("machine-select").selectedIndex;
            let mcJson = JSON.stringify(window.pageState.machineConfigs[mcIdx]);
            let xhr = new XMLHttpRequest();
            xhr.open('POST', "/setmcjson", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(mcJson);
            // Update details
            setTimeout(queryStatusUpdate, 1100);
        }

        function callAjax(url, okCallback, failCallback) {
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState === 4) {
                    if (xmlhttp.status === 200) {
                        if ((okCallback !== undefined) && (typeof okCallback !== 'undefined'))
                            okCallback(xmlhttp.responseText);
                    }
                    else {
                        if ((failCallback !== undefined) && (typeof failCallback !== 'undefined'))
                            failCallback(xmlhttp);
                    }
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        function callAjaxWithParam(url, okCallback, okParam) {
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState === 4) {
                    if (xmlhttp.status === 200) {
                        if ((okCallback !== undefined) && (typeof okCallback !== 'undefined'))
                            okCallback(xmlhttp.responseText, okParam);
                    }
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        function postAjax(url, jsonInfo, okCallback, failCallback) {
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState === 4) {
                    if (xmlhttp.status === 200) {
                        if ((okCallback !== undefined) && (typeof okCallback !== 'undefined'))
                            okCallback(xmlhttp.responseText);
                    }
                    else {
                        if ((failCallback !== undefined) && (typeof failCallback !== 'undefined'))
                            failCallback(xmlhttp);
                    }
                }
            };

            xmlhttp.open("POST", url, true);
            xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xmlhttp.send(JSON.stringify(jsonInfo));
        }

        function setupSelectMachine(callbackOpen, callbackSet) {
            let selectS = document.getElementsByClassName("select-style");
            for (let i = 0; i < selectS.length; i++) {
                selEl = selectS[i].getElementsByTagName("select")[0];
                if (selEl.options.length === 0)
                    continue;
                if (selEl.selectedIndex < 0)
                    selEl.selectedIndex = 0;
                // Selected item div
                let selItemDiv = document.createElement("div");
                selItemDiv.setAttribute("class", "select-selected");
                selItemDiv.innerHTML = selEl.options[selEl.selectedIndex].innerHTML;
                selectS[i].appendChild(selItemDiv);
                // Options div
                let optionsDiv = document.createElement("div");
                optionsDiv.setAttribute("class", "select-items select-hide");
                for (let j = 0; j < selEl.length; j++) {
                    // Option div (for each option)
                    let optionDiv = document.createElement("div");
                    optionDiv.innerHTML = selEl.options[j].innerHTML;
                    optionDiv.addEventListener("click", function (event) {
                        // Handle item click = select item
                        let selection = this.parentNode.parentNode.getElementsByTagName("select")[0];
                        let prevSibling = this.parentNode.previousSibling;
                        for (let k = 0; k < selection.length; k++) {
                            if (selection.options[k].innerHTML === this.innerHTML) {
                                selection.selectedIndex = k;
                                prevSibling.innerHTML = this.innerHTML;
                                let sameAsSel = this.parentNode.getElementsByClassName("same-as-selected");
                                for (n = 0; n < sameAsSel.length; n++) {
                                    sameAsSel[n].removeAttribute("class");
                                }
                                this.setAttribute("class", "same-as-selected");
                                break;
                            }
                        }
                        prevSibling.click();
                    });
                    optionsDiv.appendChild(optionDiv);
                    // Last item only
                    if (j === selEl.length - 1)
                        optionDiv.setAttribute("class", "select-last-option");
                }
                selectS[i].appendChild(optionsDiv);
                selItemDiv.addEventListener("click", function (event) {
                    // Select box clicked = close other select boxes & open/close current
                    event.stopPropagation();
                    closeAllSelect(this);
                    this.nextSibling.classList.toggle("select-hide");
                    this.classList.toggle("select-arrow-active");
                    if (this.nextSibling.classList.contains("select-hide"))
                        callbackSet();
                    else
                        callbackOpen();
                });
            }

            function closeAllSelect(elmnt) {
                // Close all selects
                let selArray = [];
                let selectedItems = document.getElementsByClassName("select-items");
                let selectsSelected = document.getElementsByClassName("select-selected");
                for (let i = 0; i < selectsSelected.length; i++) {
                    if (elmnt === selectsSelected[i]) {
                        selArray.push(i)
                    }
                    else {
                        selectsSelected[i].classList.remove("select-arrow-active");
                    }
                }
                for (i = 0; i < selectedItems.length; i++) {
                    if (selArray.indexOf(i)) {
                        selectedItems[i].classList.add("select-hide");
                    }
                }
            }

            // Click outside the document - close all selects
            document.addEventListener("click", closeAllSelect);
        }

        function fsSelectClick(event) {
            // console.log(event);
            event.srcElement.classList.toggle("radio-on");
            if (event.srcElement.classList.contains("radio-on"))
            {
                callAjax("/targetcmd/defaultfs/sd");
                window.pageState.fsDefault = "sd";
                event.srcElement.innerHTML = "File System = SD";
            }
            else
            {
                callAjax("/targetcmd/defaultfs/spiffs");
                window.pageState.fsDefault = "spiffs";
                event.srcElement.innerHTML = "File System = SPIFFS";
            }
        }

        function fileListUpdate() {
            callAjax("/filelist/" + window.pageState.fsDefault + "/", fileListUpdateOk, fileListUpdateFail);
        }

        function fileListUpdateFail() {
        }

        function fileSizeSI(size) {
            let e = (Math.log(size) / Math.log(1024)) | 0;
            return +(size / Math.pow(1024, e)).toFixed(2) + ' ' + ('kMGTPEZY'[e - 1] || '') + 'B';
        }

        function fileListUpdateOk(resp) {
            // Parse status received
            let fileListInfo = JSON.parse(resp);
            window.pageState.latestfileListInfo = fileListInfo;

            // Show info
            if (fileListInfo.diskSize) {
                let fileSystemInfo = document.getElementById("file-system-info");
                let fsInfoStr = "<b>Disk Size:</b> " + fileSizeSI(fileListInfo.diskSize) + ", <b>Free Bytes:</b> " + fileSizeSI(fileListInfo.diskSize - fileListInfo.diskUsed);
                fileSystemInfo.innerHTML = fsInfoStr;
            }

            // Clear the table
            let tabFiles = document.getElementById("table_files");
            let rowCount = tabFiles.rows.length;
            for (let i = rowCount - 1; i > 0; i--)
                tabFiles.deleteRow(i);

            // Add rows
            for (let i = 0; i < fileListInfo.files.length; i++) {
                let filename = fileListInfo.files[i].name;
                filename = filename.replace("/", "");
                // Check for JSON files
                let aux = filename.split('.');
                if (aux.length > 0)
                {
                    let extension = aux[aux.length-1].toLowerCase();
                    if ((extension === "json") && (filename.toLowerCase() !== 'demo.json'))
                        continue;
                }
                let filesize = fileListInfo.files[i].size;
                let row = '<tr data-file="' + filename + '">';
                row += '<td class=file-actions">'
                row += '<a class="btn btn-fileaction tooltip" onclick="deleteFile(\'' + filename + '\')">'
                row += '<svg class="icon-action"><use xlink:href="#ico-delete"></use></svg>'
                row += '<span class="tooltiptext">Delete file</span>'
                row += '</a>'
                row += '<a class="btn btn-fileaction tooltip" onclick="sendFileToTargetBuffer(\'' + filename + '\')">'
                row += '<svg class="icon-action"><use xlink:href="#icon-send"></use></svg>'
                row += '<span class="tooltiptext">Send to target buffer</span>'
                row += '</a>'
                row += '<a class="btn btn-fileaction tooltip" onclick="appendFileToTargetBuffer(\'' + filename + '\')">'
                row += '<svg class="icon-action"><use xlink:href="#icon-send-plus"></use></svg>'
                row += '<span class="tooltiptext">Append to target buffer</span>'
                row += '</a>'
                row += '<a class="btn btn-fileaction tooltip" onclick="runFileOnTarget(\'' + filename + '\')">'
                row += '<svg class="icon-action"><use xlink:href="#ico-play"></use></svg>'
                row += '<span class="tooltiptext">Run file now</span>'
                row += '</a>'
                row += '</td>'
                row += '<td class="file-name">' + filename + '</td>';
                row += '<td class="file-size hidden-xs">' + fileSizeSI(filesize) + '</td>';
                row += '</tr>';
                let newRow = tabFiles.insertRow(tabFiles.rows.length);
                newRow.innerHTML = row;
            }
        }

        function deleteFile(filename) {
            callAjax("/filedelete/" + window.pageState.fsDefault + "/" + filename);
            fileListUpdate();
        }

        function sendFileToTargetBuffer(filename) {
            callAjax("/sendfiletotargetbuffer/" + window.pageState.fsDefault + "/" + filename);
        }

        function appendFileToTargetBuffer(filename) {
            callAjax("/appendfiletotargetbuffer/" + window.pageState.fsDefault + "/" + filename);
        }

        function runFileOnTarget(filename) {
            callAjax("/runfileontarget/" + window.pageState.fsDefault + "/" + filename);
        }

        function enableTabInsertion(elementId) {
            let el = document.getElementById(elementId);
            el.onkeydown = function(e) {
                let handled = false;
                if (e.keyCode === 9) {
                    let val = this.value;
                    let selStart = this.selectionStart;
                    let selEnd = this.selectionEnd;
                    this.value = val.substring(0, selStart) + '\t' + val.substring(selEnd);
                    this.selectionStart = this.selectionEnd = selStart + 1;
                    handled = true;
                }
                return !handled;
            }
            el.onkeyup = function(e) {
                // Validate json
                machineConfigValidateForm();
            }
        }

        function termKeyPressed(event) {
            // event.preventDefault();
            // let uniCh = event.charCode || event.keyCode;  // Get the Unicode value
            // // if (((uniCh >= 64) && (uniCh <= 90)) && (event.ctrlKey))
            // //     uniCh -= 64;
            // // else if (((uniCh >= 65) && (uniCh <= 90)) && (event.shiftKey == event.getModifierState("CapsLock")))
            // //     uniCh += 32;
            // let ch = String.fromCharCode(uniCh);
            // console.log(ch, "stt", uniCh, event.ctrlKey, event.shiftKey);
            // callAjax("/sendKey/" + uniCh.toString());
        }
        function getKeyModCodes(event) {
            let modCodes = 0;
            if (event.ctrlKey)
                modCodes |= 1;
            let uniCh = event.charCode || event.keyCode;
            if (event.shiftKey != (event.getModifierState("CapsLock") && ((uniCh >= 65) && (uniCh <= 90))))
                modCodes |= 2;
            if (event.altKey)
                modCodes |= 4;
            return modCodes;
        }
        function termKeyDown(event) {
            // console.log(event);
            if ((event.keyCode === 16) || (event.keyCode === 17) || (event.keyCode === 18) || (event.keyCode === 20)) {
                // Ctrl, shift or Alt
                return;
            }
            let uniCh = event.charCode || event.keyCode;  // Get the Unicode value
            let usbKeyCode = uniCh;
            if ((uniCh >= 65) && (uniCh <= 90)) {
                usbKeyCode = uniCh - 61;
            } else if ((uniCh === 48)) {
                usbKeyCode = 0x27;
            } else if ((uniCh >= 49) && (uniCh <= 57)) {
                usbKeyCode = uniCh - 49 + 0x1e;
            } else if ((uniCh === 13)) {
                usbKeyCode = 0x28;
            } else if ((uniCh === 27)) {
                usbKeyCode = 0x29;
            } else if ((uniCh === 8)) {
                usbKeyCode = 0x2a;
            } else if ((uniCh === 9)) {
                usbKeyCode = 0x2b;
            } else if ((uniCh === 32)) {
                usbKeyCode = 0x2c;
            } else if ((uniCh === 189)) {
                usbKeyCode = 0x2d;
            } else if ((uniCh === 187)) {
                usbKeyCode = 0x2e;
            } else if ((uniCh === 219)) {
                usbKeyCode = 0x2f;
            } else if ((uniCh === 221)) {
                usbKeyCode = 0x30;
            } else if ((uniCh === 220)) {
                usbKeyCode = 0x31;
            } else if ((uniCh === 163)) {
                usbKeyCode = 0x32;
            } else if ((uniCh === 186)) {
                usbKeyCode = 0x33;
            } else if ((uniCh === 222)) {
                usbKeyCode = 0x34;
            } else if ((uniCh === 192)) {
                usbKeyCode = 0x35;
            } else if ((uniCh === 188)) {
                usbKeyCode = 0x36;
            } else if ((uniCh === 190)) {
                usbKeyCode = 0x37;
            } else if ((uniCh === 191)) {
                usbKeyCode = 0x38;
            } else if ((uniCh >= 112) && (uniCh <= 123)) {
                usbKeyCode = uniCh - 112 + 0x3a;
            } else if ((uniCh === 45)) {
                usbKeyCode = 0x49;
            } else if ((uniCh === 36)) {
                usbKeyCode = 0x4a;
            } else if ((uniCh === 33)) {
                usbKeyCode = 0x4b;
            } else if ((uniCh === 46)) {
                usbKeyCode = 0x4c;
            } else if ((uniCh === 35)) {
                usbKeyCode = 0x4d;
            } else if ((uniCh === 34)) {
                usbKeyCode = 0x4e;
            } else if ((uniCh === 39)) {
                usbKeyCode = 0x4f;
            } else if ((uniCh === 37)) {
                usbKeyCode = 0x50;
            } else if ((uniCh === 40)) {
                usbKeyCode = 0x51;
            } else if ((uniCh === 38)) {
                usbKeyCode = 0x52;
            }

            callAjax("/sendKey/" + uniCh.toString() + "/" + usbKeyCode.toString() + "/" + getKeyModCodes(event).toString());
            event.preventDefault();
            //     if (event.ctrlKey) {
            //         event.preventDefault();
            //         uniCh -= 64;
            //         let ch = String.fromCharCode(uniCh);
            //         console.log(ch, "stt", uniCh, event.ctrlKey, event.shiftKey);
            //         callAjax("/sendKey/" + uniCh.toString());
            //         return;
            //     }
            // } else if (uniCh == 38) {
            //     callAjax("/sendKey/");
            // if (((uniCh >= 64) && (uniCh <= 90)) && (event.ctrlKey))
            //     uniCh -= 64;
            // else if (((uniCh >= 65) && (uniCh <= 90)) && (event.shiftKey == event.getModifierState("CapsLock")))
            //     uniCh += 32;
        }
        function setAnsiColours() {
            window.pageState.termColours = [
                "000000", "800000", "008000", "808000", "000080", "800080", "008080", "c0c0c0", 
                "808080", "ff0000", "00ff00", "ffff00", "0000ff", "ff00ff", "00ffff", "ffffff", 
                "000000", "00005f", "000087", "0000af", "0000df", "0000ff", "005f00", "005f5f",
                "005f87", "005faf", "005fdf", "005fff", "008700", "00875f", "008787", "0087af", 
                "0087df", "0087ff", "00af00", "00af5f", "00af87", "00afaf", "00afdf", "00afff",
                "00df00", "00df5f", "00df87", "00dfaf", "00dfdf", "00dfff", "00ff00", "00ff5f", 
                "00ff87", "00ffaf", "00ffdf", "00ffff", "5f0000", "5f005f", "5f0087", "5f00af", 
                "5f00df", "5f00ff", "5f5f00", "5f5f5f", "5f5f87", "5f5faf", "5f5fdf", "5f5fff", 
                "5f8700", "5f875f", "5f8787", "5f87af", "5f87df", "5f87ff", "5faf00", "5faf5f",
                "5faf87", "5fafaf", "5fafdf", "5fafff", "5fdf00", "5fdf5f", "5fdf87", "5fdfaf",
                "5fdfdf", "5fdfff", "5fff00", "5fff5f", "5fff87", "5fffaf", "5fffdf", "5fffff", 
                "870000", "87005f", "870087", "8700af", "8700df", "8700ff", "875f00", "875f5f", 
                "875f87", "875faf", "875fdf", "875fff", "878700", "87875f", "878787", "8787af", 
                "8787df", "8787ff", "87af00", "87af5f", "87af87", "87afaf", "87afdf", "87afff", 
                "87df00", "87df5f", "87df87", "87dfaf", "87dfdf", "87dfff", "87ff00", "87ff5f",
                "87ff87", "87ffaf", "87ffdf", "87ffff", "af0000", "af005f", "af0087", "af00af", 
                "af00df", "af00ff", "af5f00", "af5f5f", "af5f87", "af5faf", "af5fdf", "af5fff",
                "af8700", "af875f", "af8787", "af87af", "af87df", "af87ff", "afaf00", "afaf5f",
                "afaf87", "afafaf", "afafdf", "afafff", "afdf00", "afdf5f", "afdf87", "afdfaf", 
                "afdfdf", "afdfff", "afff00", "afff5f", "afff87", "afffaf", "afffdf", "afffff",
                "df0000", "df005f", "df0087", "df00af", "df00df", "df00ff", "df5f00", "df5f5f",
                "df5f87", "df5faf", "df5fdf", "df5fff", "df8700", "df875f", "df8787", "df87af", 
                "df87df", "df87ff", "dfaf00", "dfaf5f", "dfaf87", "dfafaf", "dfafdf", "dfafff",
                "dfdf00", "dfdf5f", "dfdf87", "dfdfaf", "dfdfdf", "dfdfff", "dfff00", "dfff5f", 
                "dfff87", "dfffaf", "dfffdf", "dfffff", "ff0000", "ff005f", "ff0087", "ff00af",
                "ff00df", "ff00ff", "ff5f00", "ff5f5f", "ff5f87", "ff5faf", "ff5fdf", "ff5fff", 
                "ff8700", "ff875f", "ff8787", "ff87af", "ff87df", "ff87ff", "ffaf00", "ffaf5f",
                "ffaf87", "ffafaf", "ffafdf", "ffafff", "ffdf00", "ffdf5f", "ffdf87", "ffdfaf", 
                "ffdfdf", "ffdfff", "ffff00", "ffff5f", "ffff87", "ffffaf", "ffffdf", "ffffff", 
                "080808", "121212", "1c1c1c", "262626", "303030", "3a3a3a", "444444", "4e4e4e",
                "585858", "606060", "666666", "767676", "808080", "8a8a8a", "949494", "9e9e9e",
                "a8a8a8", "b2b2b2", "bcbcbc", "c6c6c6", "d0d0d0", "dadada", "e4e4e4", "eeeeee"];
        }
        function validateHexInput(event, memDumpElementId) {
            console.log(event);
            if (event.code === "Backspace" || event.code === "Delete" || event.code === "Enter")
                return true
            const okKeys = "01234567890ABCDEFabcdef"
            if (okKeys.includes(event.key))
                return true;
            return false
        }
        function onChangeHexInput(event, memDumpElementId) {
            console.log(event);
            const val = event.target.value
            // const rslt = /^([0-9A-Fa-f]{1,4})$/.test(val)
            let addr = parseInt(event.target.value,16);
            showHexDump(isNaN(addr) ? 0 : addr, memDumpElementId)
        }
        function showHexDumps() {
            let el = document.getElementById('debugger-mem1-addr');
            let addr = parseInt(el.value,16);
            showHexDump(addr, 'debugger-mem1');
            el = document.getElementById('debugger-mem2-addr');
            addr = parseInt(el.value,16);
            showHexDump(addr, 'debugger-mem2');
        }
    </script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Helvetica;
            line-height: 1.4em;
            font-size: 12pt;
            margin: 0;
            color: #e0e0e0;
            background-color: #DFDBE5;
            /* This pattern is from http://www.heropatterns.com/ */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%239C92AC' fill-opacity='0.5' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E");
        }

        a {
            color: #369;
        }

        th {
            text-align: left;
            font-weight: normal;
            color: #e0e0e0;
        }

        td,
        th {
            padding: 0;
            display: table-cell;
            text-align: left;
        }

        table {
            border-spacing: 0;
            border-collapse: collapse;
        }

        a {
            text-decoration: none;
            background-color: transparent;
            cursor: pointer;
            color: #e0e0e0;
        }

        td>a {
            color: #337ab7;
        }

        .layout-region {
            border: 2px #ccc;
            border-radius: 20px;
            width: 98%;
            margin: 15px auto;
            padding: 20px;
            background: #202020;
        }

        .drop-zone {
            border: 2px dashed #ccc;
        }

        .drop-zone.highlight {
            border: 2px solid #9595de;
        }

        p {
            margin-top: 0;
        }

        .file-upload-form {
            margin-bottom: 10px;
        }

        .button {
            display: inline-block;
            padding: 5px 10px;
            background: #444;
            cursor: pointer;
            border-radius: 5px;
            border: 1px solid #666;
            margin-bottom: 10px;
        }

        .button:hover {
            background: #666;
        }

        .btn {
            display: inline-block;
            padding: 6px 12px;
            margin-bottom: 0;
            font-size: 14px;
            font-weight: normal;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            touch-action: manipulation;
            cursor: pointer;
            user-select: none;
            border: 1px solid transparent;
            border-radius: 4px;
            text-decoration: none;
        }

        .btn-fileaction {
            padding: 0 5px;
        }

        .btn-config {
            padding: 6px 3px 6px 5px;
            margin-left: 10px;
            height: 40px;
            border: none;
        }

        .btn-ok {
            color:white;
        }

        .btn-cancel {
            color:white;
        }

        .icon-config {
            color: #e0e0e0;
            fill: #e0e0e0;
            width: 30px;
            height: 30px;
            vertical-align: middle;
        }

        .icon-action {
            color: #e0e0e0;
            fill: #e0e0e0;
            width: 32px;
            height: 32px;
            vertical-align: middle;
        }

        #fileElemRun {
            display: none;
        }

        #fileElemUpload {
            display: none;
        }

        progress {
            width: 100%;
            min-height: 100%;
            background-color: #444;
            border-color: #333;
            border-radius: 5px;
            color: #9595de;
            margin-bottom: 6px;
        }

        progress::-webkit-progress-bar {
            width: 100%;
            min-height: 100%;
            background-color: #444;
            border-color: #333;
            border-radius: 5px;
        }

        /* Firefox */
        progress::-moz-progress-bar {
            background-color: #9595de;
            border-radius: 5px;
            border-color: #333;
        }

        /* Chrome */
        progress::-webkit-progress-value {
            background-color: #9595de;
            border-radius: 5px;
            border-color: #333;
        }

        #footer-area p {
            font-size: 0.8rem;
            font-style: italic;
            color: #9595de;
            margin: 0;
        }

        #heading-area h1 {
            text-align: center;
            margin: 5px 0;
        }

        #control-area span {
            margin: 5px 0;
        }

        .select-style {
            position: relative;
        }

        .select-style select {
            display: none;
        }

        .select-selected {
            background-color: #444;
            margin-bottom: 10px;
            height: 40px;
        }

        /* Style arrow in select element */
        .select-selected:after {
            position: absolute;
            content: "";
            top: 14px;
            right: 10px;
            width: 0;
            height: 0;
            border: 6px solid transparent;
            border-color: #fff transparent transparent transparent;
        }

        /* Point arrow upwards when the select open*/
        .select-selected.select-arrow-active:after {
            border-color: transparent transparent #fff transparent;
            top: 7px;
        }

        /* Style items including the selected */
        .select-items div,
        .select-selected {
            padding: 8px;
            border: 1px solid transparent;
            border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
            cursor: pointer;
            user-select: none;
            border-radius: 5px;
        }

        .select-selected.select-arrow-active {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .select-last-option {
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }

        /* Style items */
        .select-items {
            position: absolute;
            background-color: #444;
            top: 80%;
            left: 0;
            right: 0;
            z-index: 99;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }

        /* Hide items when the select closed */
        .select-hide {
            display: none;
        }

        .select-items div:hover,
        .same-as-selected {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .uiDisabled {
            opacity: 40%;
        }
        .uiPanel2Col {
            display: flex;
            flex-direction: row;
        }
        .uiPanelBordered {
            border-radius: 5px;
            border: solid 1px #444444;
        }
        .uiPanelSubButtons {
            display: flex;
            flex-direction: row;
        }
        .uiPanelColumn {
            flex: 80%;
        }
        .uiPanelGroup {
            padding: 10px;
            margin-bottom: 10px;
        }
        @media screen and (max-width: 950px) {
            .uiPanelCol2HideWidth {
                display: none;
            }
        }
        .uiSmallerText {
            font-size: 0.8rem;
        }
        .uiTable {
            border: 0;
            width: 100%;
            max-width: 100%;
            border-spacing: 0;
            border-collapse: collapse;
            background-color: transparent;
            text-align: center;
            vertical-align: middle !important;
        }

        .uiTable>thead>tr>th {
            vertical-align: bottom;
            border-bottom: 2px solid #666;
        }

        .uiTable>thead>tr>th,
        .uiTable>tbody>tr>th,
        .uiTable>tfoot>tr>th,
        .uiTable>thead>tr>td,
        .uiTable>tbody>tr>td,
        .uiTable>tfoot>tr>td {
            padding: 8px;
            line-height: 1.42857143;
            vertical-align: center;
            border-top: 1px solid #666;
        }

        .uiTable>caption+thead>tr:first-child>th,
        .uiTable>colgroup+thead>tr:first-child>th,
        .uiTable>thead:first-child>tr:first-child>th,
        .uiTable>caption+thead>tr:first-child>td,
        .uiTable>colgroup+thead>tr:first-child>td,
        .uiTable>thead:first-child>tr:first-child>td {
            border-top: 0;
        }

        .uiTableBordered>thead>tr>th,
        .uiTableBordered>tbody>tr>th,
        .uiTableBordered>tfoot>tr>th,
        .uiTableBordered>thead>tr>td,
        .uiTableBordered>tbody>tr>td,
        .uiTableBordered>tfoot>tr>td {
            border: 1px solid #666;
        }

        .uiTableBordered>thead>tr>th,
        .table-bordered>thead>tr>td {
            border-bottom-width: 2px;
        }

        .uiTableBordered {
            border: 1px solid #666;
            vertical-align: center;
        }

        .uiTableFiles {
            margin-bottom: 15px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted black;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -100px;
            /* Fade in tooltip - takes 1 second to go from 0% to 100% opac: */
            opacity: 0;
            transition: opacity 1s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .rdcheckoptions {
            display: inline-block;
            margin-right: 20px;
        }

        .rdcheckcontainer {
            display: inline-block;
            position: relative;
            padding-left: 25px;
            margin-bottom: 10px;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .rdcheckcontainer input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* custom checkbox */
        .rdcheckmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: #555;
        }

        /* Mouse-over add background */
        .rdcheckcontainer:hover input~.rdcheckmark {
            background-color: #999;
        }

        /* When checked add background */
        .rdcheckcontainer input:checked~.rdcheckmark {
            background-color: #555;
        }

        /* Create the checkmark/indicator (hidden when not checked) */
        .rdcheckmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the checkmark when checked */
        .rdcheckcontainer input:checked~.rdcheckmark:after {
            display: block;
        }

        /* Style the checkmark/indicator */
        .rdcheckcontainer .rdcheckmark:after {
            left: 7px;
            top: 1px;
            width: 4px;
            height: 12px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }

        .compound-line {
            display: inline-flex;
            width: 100%;
        }

        .compound-line-first {
            flex-grow: 1;
        }

        /* .mfp-zoom-in {

            .mfp-with-anim {
                opacity: 0;
                transition: all 0.2s ease-in-out;
                transform: scale(0.8);
            }

            &.mfp-bg {
                opacity: 0;
                transition: all 0.3s ease-out;
            }

            &.mfp-ready {
                .mfp-with-anim {
                    opacity: 1;
                    transform: scale(1);
                }

                &.mfp-bg {
                    opacity: 0.8;
                }
            }

            &.mfp-removing {

                .mfp-with-anim {
                    transform: scale(0.8);
                    opacity: 0;
                }

                &.mfp-bg {
                    opacity: 0;
                }

            }
        } */
        .popup-machine {
            position: relative;
            background: #444444;
            padding: 5px;
            /* margin: 0 auto;  */
            margin-bottom: 10px;

        }
        .popup-machine textarea {
            background: #444444;
            width:100%;
            min-height: 6rem;
            color: white;
            border: none;
        }
        .popup-hidden {
            display: none;
        }
        .data-invalid {
            color: red;
            font-weight: bold;
            margin-left: 20px;
        }
        .data-valid {
            color: green;
            font-weight: normal;
            margin-left: 20px;
        }
        .clock-setting {
            display: inline-block;
            padding: 5px 10px;
            background: #444;
            border-radius: 5px;
            border: 1px solid #666;
        }
        .clock-setting input {
            background: #444;
            /* border: 1px solid grey; */
            border: none;
            font-size: 1rem;
            color: white;
        }
        .term-text {
            background-color: #000000;
            color: white;
            width: 100%;
            height: auto;
            font-family: "Lucida Console", Monaco, monospace;
            line-height: 0.2rem;
            min-height: inherit;
            padding: 1px;
        }
        #debugger-disasm {
            background-color: #000000;
            color: white;
            width: 100%;
            height: auto;
            font-family: "Lucida Console", Monaco, monospace;
            min-height: inherit;
            padding: 1px;
            white-space: pre;
        }
        #debugger-regs {
            background-color: #000000;
            color: white;
            height: auto;
            font-family: "Lucida Console", Monaco, monospace;
            line-height: 0.2rem;
            min-height: inherit;
            padding: 1px;
        }
        .debugger-memory {
            background-color: #000000;
            color: white;
            width: 100%;
            height: auto;
            font-family: "Lucida Console", Monaco, monospace;
            min-height: inherit;
            padding: 1px;
            white-space: pre;
        }
        .uiInput-hex {
            color: #eeeeee;
            background-color: #000000;
            border: none;
            height: fit-content;
            width: 100%;
        }
        .uiInput-label {
            padding-right: 10px;
        }
        .regs-label {
            font-weight: lighter;
        }
        .regs-val {
            font-weight: bold;
        }
        .term-panel {
            min-height: 1.2rem;
        }
        .radio-on {
            background-color: #602020;
        }
        .panel-hidden {
            display: none;
        }
    </style>
</head>

<body onload="bodyIsLoaded()">

    <div>
        <div id="heading-area" class="layout-region">
            <h1>Bus-Raider Control Panel</h1>
        </div>
        <div id="machine-select-area" class="layout-region">
            <div class="uiPanelSub">
                <form class="machine-select-form">
                    <p>Select target machine</p>
                    <div class="compound-line">
                        <div class="compound-line-first select-style">
                            <select id="machine-select">
                            </select>
                        </div>
                        <div>
                            <a class="button btn-config tooltip" onclick="machinePopupToggle();">
                                <svg class="icon-config">
                                    <use xlink:href="#icon-config"></use>
                                </svg>
                                <span class="tooltiptext">Configure Machine</span>
                            </a>
                        </div>
                    </div>
                    <!-- Machine config -->
                    <div id="popup-machine" class="popup-machine popup-hidden">
                        <textarea id='popup-machine-text'>{}</textarea>
                        <div>
                            <button id='popup-machine-ok' class="button btn-ok" onclick="machineConfigOk();">Ok</button>
                            <button class="button btn-cancel" onclick="machineConfigCancel();">Cancel</button>
                            <label id="popup-machine-status"></label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="uiPanelSub">
                <div class="clock-setting">
                    <label>Clock</label>
                    <input id="clock-freq-hz" type="number" max=50.0 min=0 value=1.0 step=0.1 class="clock-freq" onchange="clockHzSet();">
                    <label>MHz</label>
                </div>
                <span class="button radio" onclick="termShowClick(event)">Show Terminal</span>
                <span class="button radio" onclick="debuggerShowClick(event)">Show Debugger</span>
            </div>
        </div>
        <div id="term-panel" tabindex="110" class="layout-region panel-hidden" onkeydown="termKeyDown(event)">
            <div class="uiPanelSub" onkeydown="termKeyDown(event)">
                <div id="term-text" class="term-text" onkeypress="termKeyPressed(event)" onkeydown="termKeyDown(event)"></div>
            </div>
        </div>
        <div id="debugger-panel" class="layout-region panel-hidden">
            <div class="uiPanelSub">
                <span class="button" onclick="callAjax('/targetcmd/debugBreak', debuggerUpdate);">Break</span>
                <span class="button" onclick="sendCmdToTarget('debugContinue'); enableDebugger(false);">Continue</span>
                <span class="button" onclick="callAjax('/targetcmd/debugStepIn', debuggerUpdate);">Step In</span>
            </div>
            <div id="debugger-disregs" class="uiPanelSub uiPanel2Col uiPanelBordered uiPanelGroup uiDisable uiSmallerText">
                <code id="debugger-disasm" class="uiPanelColumn">
                </code>
                <div id="debugger-regs" class="uiPanelRegsColumn">
                    <table class="uiTable uiTableBordered uiTableFiles uiTableStripe">
                        <tbody>
                          <colgroup>
                            <col style="width: fit-content;">
                            <col style="width: fit-content;">
                            <col style="width: fit-content;">
                            <col style="width: fit-content;">
                          </colgroup>
                          <tr>
                            <td class="regs-label">PC</td>
                            <td id="regs-PC" class="regs-val"></td>
                            <td class="regs-label">SP</td>
                            <td id="regs-SP" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">AF</td>
                            <td id="regs-AF" class="regs-val"></td>
                            <td class="regs-label">AF'</td>
                            <td id="regs-AFDASH" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">F</td>
                            <td id="regs-FLAGS" class="regs-val"></td>
                            <td class="regs-label">F'</td>
                            <td id="regs-FLAGSDASH" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">HL</td>
                            <td id="regs-HL" class="regs-val"></td>
                            <td class="regs-label">HL'</td>
                            <td id="regs-HLDASH" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">DE</td>
                            <td id="regs-DE" class="regs-val"></td>
                            <td class="regs-label">DE'</td>
                            <td id="regs-DEDASH" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">BC</td>
                            <td id="regs-BC" class="regs-val"></td>
                            <td class="regs-label">BC'</td>
                            <td id="regs-BCDASH" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">IX</td>
                            <td id="regs-IX" class="regs-val"></td>
                            <td class="regs-label">IY</td>
                            <td id="regs-IY" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">I</td>
                            <td id="regs-I" class="regs-val"></td>
                            <td class="regs-label">R</td>
                            <td id="regs-R" class="regs-val"></td>
                          </tr>
                          <tr>
                            <td class="regs-label">IM</td>
                            <td id="regs-IM" class="regs-val"></td>
                            <td class="regs-label">IFF</td>
                            <td id="regs-IFF" class="regs-val"></td>
                          </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="debugger-memdump" class="uiPanelSub uiDisable uiSmallerText">
                <div class="uiPanelSub uiPanel2Col">
                    <div class="uiPanelBordered uiPanelGroup uiPanelColumn">
                        <div class="uiPanelSubButtons">
                            <p class="uiInput-label">Memory Address</p>
                            <input id="debugger-mem1-addr" class="uiInput-hex" value="0000" onkeydown="return validateHexInput(event, 'debugger-mem1');" 
                                    oninput="onChangeHexInput(event, 'debugger-mem1');">
                                </input>
                        </div>
                        <code id="debugger-mem1" class="debugger-memory">
                        </code>
                    </div>
                    <div class="uiPanelBordered uiPanelGroup uiPanelColumn uiPanelCol2HideWidth">
                        <div class="uiPanelSubButtons">
                            <p class="uiInput-label">Memory Address</p>
                            <input id="debugger-mem2-addr" class="uiInput-hex" value="0000" onkeydown="return validateHexInput(event, 'debugger-mem2');" 
                                    oninput="onChangeHexInput(event, 'debugger-mem2');"></input>
                        </div>
                        <code id="debugger-mem2" class="debugger-memory">
                        </code>
                    </div>
                </div>
            </div>
            <div class="uiPanelSub">
                <span class="button" onclick="sendCmdToTarget('targetReset')">Reset Z80</span>
                <span class="button" onclick="sendCmdToTarget('progClear')">Clear target buffer</span>
                <span class="button" onclick="sendCmdToTarget('progWrite')">Program from buffer</span>
                <span class="button" onclick="sendCmdToTarget('programandexec')">Program and execute</span>
            </div>
        </div>
        <div id="upload-and-run" class="layout-region drop-zone">
            <div class="uiPanelSub">
                <form class="file-upload-form">
                    <p>Drop files to immediately run on the target</p>
                    <label class="button" for="fileElemRun">Select a file to immediately run</label>
                    <input type="file" id="fileElemRun" onchange="uploadAndRunFiles(this.files)">
                </form>
            </div>
            <progress id="progress-bar-run" max=100 value=0></progress>
        </div>
        <!--         <div id="upload-only" class="layout-region drop-zone">
            <form class="file-upload-form">
                <p>Drop files to upload to the Bus-Raider's buffer</p>
                <input type="file" id="fileElem" onchange="uploadToFileManager(this.files)">
                <label class="button" for="fileElem">Select a file to upload</label>
            </form>
            <progress id="progress-bar-buffer" max=100 value=0></progress>

            <span class="button" onclick="sendCmdToTarget('progWrite')">Send to target</span>

            <span class="button" onclick="sendCmdToTarget('ioclrtarget')">Clear all RC2014 IO</span> 
        </div> -->
        <div id="file-manager" class="layout-region drop-zone">
            <form class="file-upload-form">
                <div class=uiPanelSub>
                    <p>Drop files to upload to ESP32 file system</p>
                    <input type="file" id="fileElemUpload" onchange="uploadToFileManager(this.files)">
                    <label class="button" for="fileElemUpload">Select a file to upload</label>
                    <!-- <span class="button radio" onclick="fsSelectClick(event)">File System = SPIFFS</span> -->
                </div>
                <progress id="progress-bar-file-manager" max=100 value=0></progress>
                <div id="file-system-info" class="uiPanelSub"><span></span></div>
                <table class="uiTable uiTableBordered uiTableFiles uiTableStripe" id="table_files">
                    <thead>
                        <tr>
                            <th><a href="#" data-attribute="action">Actions</a>
                            </th>
                            <th><a href="#" data-attribute="filename">File Name</a>
                            </th>
                            <th><a href="#" data-attribute="size">Size</a>
                            </th>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </form>
        </div>
        <!--         <div id="terminal-area" class="layout-region">
        </div>
        -->
        <div id="footer-area" class="layout-region">
            <p>Developed by Rob Dobson 2019, inspired by RC2014 and PiGFX</p>
        </div>
    </div>

    <!-- SVG icons -->
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
        xml:space="preserve">
        <symbol id="icon-send" viewBox="0 0 1200 1200">
            <g>
                <path d="M1200 103l-483 276l-314 -399v423h-399l1196 796v-1096zM483 424v-230l683 953z"
                    transform="scale(1,-1) translate(0,-1200)"></path>
            </g>
        </symbol>
        <symbol id="icon-send-plus" viewBox="0 0 1200 1200">
            <g>
                <path
                    d="M 507.57247,298.94304 H 318.98641 V 487.52909 H 261.54552 V 298.94304 H 72.959465 V 243.57832 H 261.54552 V 54.992266 h 57.44089 V 243.57832 H 507.57247 Z M 1200,1100.9135 l -483,-276 -314,399 v -423 H 4 L 1200,4.9135045 Z m -717,-321 v 230 L 1166,56.913505 Z">
                </path>
            </g>
        </symbol>
        <symbol id="ico-play" viewBox="0 0 233 233">
            <g>
                <path d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266
        c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267
        l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z" />
            </g>
        </symbol>
        <symbol id="ico-delete" viewBox="0 0 26 26">
            <g>
                <path
                    d="M 11 -0.03125 C 10.164063 -0.03125 9.34375 0.132813 8.75 0.71875 C 8.15625 1.304688 7.96875 2.136719 7.96875 3 L 4 3 C 3.449219 3 3 3.449219 3 4 L 2 4 L 2 6 L 24 6 L 24 4 L 23 4 C 23 3.449219 22.550781 3 22 3 L 18.03125 3 C 18.03125 2.136719 17.84375 1.304688 17.25 0.71875 C 16.65625 0.132813 15.835938 -0.03125 15 -0.03125 Z M 11 2.03125 L 15 2.03125 C 15.546875 2.03125 15.71875 2.160156 15.78125 2.21875 C 15.84375 2.277344 15.96875 2.441406 15.96875 3 L 10.03125 3 C 10.03125 2.441406 10.15625 2.277344 10.21875 2.21875 C 10.28125 2.160156 10.453125 2.03125 11 2.03125 Z M 4 7 L 4 23 C 4 24.652344 5.347656 26 7 26 L 19 26 C 20.652344 26 22 24.652344 22 23 L 22 7 Z M 8 10 L 10 10 L 10 22 L 8 22 Z M 12 10 L 14 10 L 14 22 L 12 22 Z M 16 10 L 18 10 L 18 22 L 16 22 Z " />
            </g>
        </symbol>
        <symbol id="icon-config" viewBox="20 20 40 40">
            <g>
                <path
                    d="M 38,23.5C 38.8643,23.5 39.7109,23.5756 40.5337,23.7206L 42.6275,18.5381L 48.1901,20.787L 46.0964,25.9692C 47.6473,27.0149 48.9851,28.3527 50.0308,29.9036L 55.213,27.8099L 57.4619,33.3725L 52.2794,35.4664C 52.4244,36.2891 52.5,37.1357 52.5,38C 52.5,38.8643 52.4244,39.7109 52.2794,40.5337L 57.4619,42.6275L 55.213,48.1901L 50.0308,46.0964C 49.0795,47.5073 47.8865,48.7418 46.5112,49.7405L 48.7844,54.8462L 43.3041,57.2891L 41.0307,52.1828C 40.0533,52.3906 39.0394,52.5 38,52.5C 37.1357,52.5 36.2891,52.4244 35.4664,52.2794L 33.3725,57.462L 27.8099,55.213L 29.9036,50.0309C 28.3527,48.9851 27.0149,47.6473 25.9691,46.0964L 20.787,48.1901L 18.538,42.6275L 23.7206,40.5336C 23.5756,39.7109 23.5,38.8643 23.5,38C 23.5,37.1357 23.5756,36.2891 23.7206,35.4664L 18.538,33.3725L 20.787,27.8099L 25.9691,29.9036C 26.9205,28.4927 28.1135,27.2582 29.4889,26.2594L 27.2157,21.1537L 32.6959,18.7109L 34.9694,23.8172C 35.9468,23.6094 36.9606,23.5 38,23.5 Z M 38,28C 32.4771,28 28,32.4772 28,38C 28,43.5229 32.4771,48 38,48C 43.5228,48 48,43.5229 48,38C 48,32.4772 43.5228,28 38,28 Z" />
            </g>
        </symbol>
    </svg>
</body>

</html>